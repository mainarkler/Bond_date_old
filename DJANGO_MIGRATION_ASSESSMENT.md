# Анализ текущего состояния проекта и целесообразности переноса на Django

## 1) Что сейчас есть в проекте

Текущее приложение — это **монолитный Streamlit-дэшборд** с несколькими аналитическими сценариями в одном файле `app.py`:

- Претрейд РЕПО.
- Календарь выплат.
- Расчёт VM по FORTS.
- Sell stress (акции/облигации).
- Аналитика состава индекса.

Ключевые наблюдения по архитектуре:

1. **UI и бизнес-логика сильно смешаны** в `app.py` (кнопки, `st.session_state`, сетевые вызовы, расчёты, преобразования данных).
2. Есть зачатки модульности в виде `sell_stress.py` и `index_analytics.py`, но часть дублирующей логики остаётся в `app.py`.
3. Источники данных — внешние API MOEX/ЦБ (сетевые запросы, пагинация, retry), без отдельного слоя сервисов/репозиториев.
4. Нет тестового контура (unit/integration), минимальная документация (`README.md` фактически пустой).
5. Отсутствуют модели данных/БД, роли пользователей, административный контур.

## 2) Сильные стороны текущего решения

- Быстрый time-to-market для аналитических внутренних инструментов.
- Низкая сложность деплоя на старте.
- Удобный интерактив для data-oriented задач (таблицы, загрузка/выгрузка, прототипирование).

## 3) Технический долг и риски

- **Сопровождаемость**: большой `app.py` затрудняет развитие.
- **Тестируемость**: вычисления и IO не изолированы, сложно писать стабильные тесты.
- **Масштабирование команды**: при росте функциональности возрастает риск регрессий.
- **Производительность/стабильность**: блокирующие сетевые операции в потоке UI.
- **Governance/безопасность**: если появятся пользователи, права доступа, аудит, Streamlit-стек потребует кастомных решений.

## 4) Насколько целесообразно переносить в Django

## Короткий вывод

**Полный перенос на Django прямо сейчас целесообразен только при наличии продуктовых причин**:

- нужна многопользовательская система с ролями;
- нужны БД-модели, история расчётов, аудит;
- нужен API-контур для внешних интеграций;
- ожидается долгий lifecycle как корпоративного сервиса.

Если проект остаётся внутренним аналитическим инструментом 1–10 пользователей без сложной доменной модели, то **полная миграция в Django сейчас скорее преждевременна**.

## 5) Рекомендованная стратегия

Вместо “big bang” миграции:

1. **Сначала рефакторинг текущего Streamlit-проекта**:
   - вынести расчёты в `services/`;
   - вынести MOEX/ЦБ-клиенты в `clients/`;
   - описать DTO/валидацию входов;
   - покрыть критичные формулы unit-тестами.

2. **Сделать “Django-ready” слой доменной логики** (framework-agnostic).

3. После стабилизации принять решение:
   - оставить Streamlit как UI, а backend (API, расчёты, хранение) вынести в Django/FastAPI;
   - либо перейти на Django целиком, если требуется полноценное web-приложение.

## 6) Практический критерий принятия решения

Имеет смысл идти в Django, если одновременно выполняются ≥3 пункта:

- нужны учётные записи, роли, SSO/LDAP;
- требуется БД и долгосрочное хранение результатов;
- нужны фоновые джобы (очереди, расписания, ретраи);
- требуется внешний API;
- ожидается развитие продукта более 6–12 месяцев командой >2 разработчиков.

Если выполняется 0–2 пункта, оптимальнее продолжить на Streamlit и инвестировать в модульность + тесты.

## 7) Оценка стоимости миграции

Ориентировочно:

- Частичный путь (backend на Django + текущий UI): **средняя стоимость**, низкий риск.
- Полная миграция UI+backend в Django: **высокая стоимость**, выше риск просадки темпа.

## 8) Итоговая рекомендация для текущего репозитория

Для данного состояния кода оптимальный путь:

- **Не делать немедленный полный перенос в Django**.
- **Провести 1–2 итерации архитектурного рефакторинга** в текущем проекте.
- Затем запустить PoC backend-слоя (Django/FastAPI) для 1–2 наиболее критичных сценариев (например, Sell stress и VM), оценить выигрыш по поддержке и масштабируемости.

Это даст управляемую миграцию с минимальным риском остановки поставки функционала.
